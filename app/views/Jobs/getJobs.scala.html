@(jobs: List[Job])

@main("Jobs", "jobs", Array("notifications.js","fuzzyDates.js")) {

<script type="text/javascript" charset="utf-8">
$(function(){Notifications.init("@{routes.Notifications.websocket(Long.parseLong(flash().get("browserId"))).webSocketURL(request)}", "@{routes.Notifications.xhr(Long.parseLong(flash().get("browserId"))).absoluteURL(request)}");});
</script>

<hgroup>
<h1>Jobs</h1>
@if(session.get("admin")=="true"){
	<p>Displaying jobs for all users</p>
}else{
@if(Setting.get("users.guest.shareJobs") == "true"){
	<p>Displaying jobs for all guests</p>
}else{
	<p>Displaying your jobs</p>
}}
</hgroup>

@if(jobs.size() > 0) {
	
	<table class="table joblist">
	<tr>
		<th><img src="@routes.Assets.at("images/icon-info-sign.png")" alt="Status" title="Status"/></th>
		<th>Job</th>
		<th>Results</th>
		<th>Created</th>
		@if(Controller.flash("showOwner")=="true"){
			<th>Owner</th>
		}
	</tr>
	@for(job <- jobs) {
	<tr>
		<td id="job-status-@job.id">
			@if(job.status=="RUNNING"){
				<img src="@routes.Assets.at("images/RUNNING.png")" alt="Running" title="Running"/>
			}else{
			@if(job.status=="DONE"){
				<img src="@routes.Assets.at("images/DONE.png")" alt="Done" title="Done"/>
			}else{
			@if(job.status=="ERROR"){
				<img src="@routes.Assets.at("images/ERROR.png")" alt="Error" title="Error"/>
			}else{
			@if(job.status=="IDLE"){
				<img src="@routes.Assets.at("images/IDLE.png")" alt="Idle" title="Idle"/>
			}}}}
		</td>
		<td>
			<a href="@routes.Jobs.getJob(job.id)">
				@job.nicename (@job.scriptName)<br/>
				<small class="muted">@job.id</small>
			</a>
		</td>
		<td id="job-results-@job.id">
			@if(job.status=="DONE"){
				<span><a class="btn btn-mini btn-success" href="@routes.Jobs.getResult(job.id)"><i class="icon-download-alt icon-white"></i> Download</a></span>
			}
			<script type="text/javascript">
				$(function(){Notifications.listen("job-status-@job.id", function(status){
					if(status==="RUNNING"){
						$("#job-status-@job.id").html('<img src="@routes.Assets.at("images/RUNNING.png")" alt="Running" title="Running"/>');
					}else{
					if(status==="DONE"){
						$("#job-status-@job.id").html('<img src="@routes.Assets.at("images/DONE.png")" alt="Done" title="Done"/>');
						$("#job-results-@job.id").html(' <span><a class="btn btn-mini btn-success" href="@routes.Jobs.getResult(job.id)"><i class="icon-download-alt icon-white"></i> Download</a></span>');
					}else{
					if(status==="ERROR"){
						$("#job-status-@job.id").html('<img src="@routes.Assets.at("images/ERROR.png")" alt="Error" title="Error"/>');
					}else{
					if(status==="IDLE"){
						$("#job-status-@job.id").html('<img src="@routes.Assets.at("images/IDLE.png")" alt="Idle" title="Idle"/>');
					}}}}
				});});
			</script>
		</td>
		<td>
			<span id="created-@job.id" aria-live="timer"></span><br/>
			<small class="muted">@job.created</small>
			<script type="text/javascript">$(function(){updateFuzzy("created-@job.id");});</script>
		</td>
		@if(Controller.flash("showOwner")=="true"){
			<td>
				@job.userNicename<br/>
				@if(job.user<0){
					<small class="muted">#@{-job.user}</small>
				}
			</td>
		}
	</tr>
	}
	</table>

}else {
	
	<div class="muted" style="width:100%;text-align:center;">
		<p>There are no jobs.</p>
	</div>

}

}